<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game Auto-Solver V3</title>
    <style>
        :root { --primary: #ff6b6b; --bg: #f8f9fa; }
        html,body{margin: 0px;padding: 0px;}
        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 1260px;
            height: 2800px;
        }
        
        .container {
            background: white;
            padding: 0px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            text-align: center;
        }
        
        /* Video & Canvas Overlay */
        .video-wrapper {
            position: relative;
            margin: 20px auto;
            width: 100%;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        video { width: 100%; display: block; }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }

        /* Controls */
        .control-panel { background: #f1f3f5; padding: 15px; border-radius: 8px; margin-top: 15px; text-align: left; }
        .slider-group { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .slider-group label { width: 100px; font-size: 0.9rem; font-weight: 600; }
        input[type=range] { flex: 1; cursor: pointer; }

        button { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%; margin-top: 10px; font-weight: bold; }
        button:disabled { background: #cbd5e0; cursor: not-allowed; }

        /* Result Grid */
        .game-grid { 
            width: 100%;
            height: auto;
            background: transparent;
            display: grid; 
            gap: 8px; 
            margin-top: 20px; 
        }
        
        #grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            z-index: 1;
            margin-top: 680px;
        }
        .game-grid img {
            position: absolute;
            z-index: 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            outline: inset 2px purple;
        }
        
        .cell {
            aspect-ratio: 1;
            border-radius: 50%;
            outline: 2px purple;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9em;
            font-weight: bold;
            color: #adb5bd;
            border: 2px solid transparent;
        }
        
        .cell.detected {
            outline: 2px red;
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 4px 10px rgba(255, 107, 107, 0.2);
        }
        #btnKeyMapper {
            z-index: 10;position: fixed;bottom: 20px;
        }
        </style>
    <script async src="https://docs.opencv.org/4.5.4/opencv.js" onload="onOpenCvReady();"></script>
</head>
<body>
    
    <div class="container">
        <h2>
            Memory Pattern Recorder V3 || 
            <a href="flipimage.html">Same Image Flip</a> || 
            <a href="sudokusolver.html">Sudoku Solver</a>
        </h2>
        
        <input type="file" id="videoInput" accept="video/*" style="margin-bottom: 10px; width: 100%;">
        
        <div class="video-wrapper">
            <video id="videoPlayer" muted playsinline></video>
            <canvas id="overlayCanvas"></canvas>
        </div>
        
        <div class="control-panel">
            <p style="margin: 0 0 10px 0; font-size: 0.85rem; color: #666;">Step 1: Adjust sliders until green boxes match the cards.</p>
            
            <div class="slider-group">
                <label>Top Margin</label>
                <input type="range" id="marginTop" min="0" max="50" value="23">
            </div>
            <div class="slider-group">
                <label>Bottom Margin</label>
                <input type="range" id="marginBottom" min="0" max="50" value="15">
            </div>
            <div class="slider-group">
                <label>Side Margin</label>
            <input type="range" id="marginSide" min="0" max="30" value="5">
        </div>

        <button id="processBtn" disabled>Start Analysis</button>
        <div id="status" style="margin-top:10px; font-size:0.9rem;">Loading OpenCV...</div>
    </div>
    
    <h3>Results</h3>
    <div class="game-grid">
        <img src="tem_bg.png"/>
        <div id="grid"></div>
    </div>
</div>

<canvas id="procCanvas" style="display:none;"></canvas>

<script src="script.js"></script>
</body>
<div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
    <h3>Step 4: Automate with Key Mapper</h3>
    <p style="font-size: 0.9rem; color: #666;">
        Generates a backup file for the "Key Mapper" app.<br>
        <strong>Trigger:</strong> Volume Up Button
    </p>
    <button id="btnKeyMapper" onclick="downloadKeyMapperJSON()" style="background-color: #2ecc71;">Download JSON for Key Mapper</button>
</div>
</html>
